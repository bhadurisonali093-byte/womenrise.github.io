// Smooth scrolling for internal links, mobile nav toggle, fake form submission,
// and dynamic rendering + search for the Books section.

document.addEventListener("DOMContentLoaded", () => {
  // ==========
  // Smooth scroll for nav and hero buttons
  // ==========
  const navLinks = document.querySelectorAll('a[href^="#"]');
  navLinks.forEach((link) => {
    link.addEventListener("click", (e) => {
      const targetId = link.getAttribute("href");
      if (targetId && targetId.startsWith("#")) {
        const target = document.querySelector(targetId);
        if (target) {
          e.preventDefault();
          const offset = 70; // account for sticky nav
          const rect = target.getBoundingClientRect();
          const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
          const top = rect.top + scrollTop - offset;

          window.scrollTo({
            top,
            behavior: "smooth",
          });

          // close mobile nav after clicking
          navMenu.classList.remove("open");
        }
      }
    });
  });

  // ==========
  // Mobile nav toggle
  // ==========
  const navToggle = document.querySelector(".nav-toggle");
  const navMenu = document.querySelector(".nav-links");

  if (navToggle && navMenu) {
    navToggle.addEventListener("click", () => {
      navMenu.classList.toggle("open");
    });
  }

  // ==========
  // Fake waitlist form submission
  // ==========
  const form = document.getElementById("waitlist-form");
  const statusEl = document.getElementById("form-status");

  if (form && statusEl) {
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const formData = new FormData(form);
      const name = (formData.get("name") || "").toString().trim();
      const email = (formData.get("email") || "").toString().trim();

      if (!email) {
        statusEl.textContent = "Please add your email so we can reach you.";
        statusEl.style.color = "#ff9bd5";
        return;
      }

      statusEl.textContent = name
        ? `Thank you, ${name}. You’re on the waitlist.`
        : "Thank you. You’re on the waitlist.";
      statusEl.style.color = "#8df4c9";

      // Reset form fields visually
      form.reset();
    });
  }

  // ==========
  // BOOKS: Learnings & tools from books
  //
  // To add a new book:
  // 1. Copy one of the objects below,
  // 2. Edit title / author / theme / keyLearning / link / tags.
  // ==========
  const books = [
    {
      title: "Untamed",
      author: "Glennon Doyle",
      theme: "Self-trust & leaving 'good girl' rules",
      keyLearning:
        "You are allowed to disappoint others before you disappoint yourself. Your life is not a project to impress people.",
      tags: ["boundaries", "self-worth", "leaving patriarchy"],
      link: "https://www.goodreads.com/book/show/52129515-untamed",
    },
    {
      title: "The Gifts of Imperfection",
      author: "Brené Brown",
      theme: "Shame, worthiness & being 'enough'",
      keyLearning:
        "You don’t have to earn your worth by over-performing at work, home and relationships. You are already ‘enough’ to rest and receive.",
      tags: ["self-compassion", "perfectionism", "mental health"],
      link: "https://www.goodreads.com/book/show/7015403-the-gifts-of-imperfection",
    },
    {
      title: "We Should All Be Feminists",
      author: "Chimamanda Ngozi Adichie",
      theme: "Understanding patriarchy & everyday sexism",
      keyLearning:
        "Feminism isn’t about hating men; it’s about seeing how systems are stacked against women and choosing to no longer shrink to fit them.",
      tags: ["feminism", "patriarchy", "society"],
      link: "https://www.goodreads.com/book/show/22738563-we-should-all-be-feminists",
    },
    {
      title: "Invisible Women: Exposing Data Bias in a World Designed for Men",
      author: "Caroline Criado Perez",
      theme: "How systems ignore women",
      keyLearning:
        "The world is not ‘neutral’ — from medicine to city design, missing data about women makes our lives harder and sometimes unsafe.",
      tags: ["work", "safety", "policy", "data bias"],
      link: "https://www.goodreads.com/book/show/41104077-invisible-women",
    },
    {
      title: "Atomic Habits",
      author: "James Clear",
      theme: "Small steps towards a life you choose",
      keyLearning:
        "You don’t have to turn your life upside down overnight; tiny habits, repeated daily, are enough to build health, money and self-respect.",
      tags: ["habits", "health", "money", "growth"],
      link: "https://www.goodreads.com/book/show/40121378-atomic-habits",
    },
    {
      title: "Self-Compassion",
      author: "Kristin Neff",
      theme: "Being kinder to yourself",
      keyLearning:
        "Speaking to yourself like a harsh parent does not make you stronger. Self-compassion actually gives you more courage to change.",
      tags: ["healing", "inner critic", "mental health"],
      link: "https://www.goodreads.com/book/show/9468122-self-compassion",
    },
  ];

  const booksGrid = document.getElementById("books-grid");
  const bookSearch = document.getElementById("book-search");

  function renderBooks(filterText = "") {
    if (!booksGrid) return;

    booksGrid.innerHTML = "";

    const text = filterText.trim().toLowerCase();

    const filtered = books.filter((book) => {
      if (!text) return true;
      const haystack =
        `${book.title} ${book.author} ${book.theme} ${book.keyLearning} ${(
          book.tags || []
        ).join(" ")}`.toLowerCase();
      return haystack.includes(text);
    });

    if (filtered.length === 0) {
      const empty = document.createElement("p");
      empty.textContent = "No books match this keyword yet. Try a different word.";
      empty.style.fontSize = "0.85rem";
      empty.style.color = "#b9a9d8";
      booksGrid.appendChild(empty);
      return;
    }

    filtered.forEach((book) => {
      const card = document.createElement("article");
      card.className = "card book-card";

      const title = document.createElement("h3");
      title.textContent = book.title;

      const meta = document.createElement("p");
      meta.className = "book-meta";
      meta.textContent = `${book.author} · ${book.theme}`;

      const learning = document.createElement("p");
      learning.textContent = book.keyLearning;

      const badgeRow = document.createElement("div");
      badgeRow.className = "book-badge-row";

      const themeBadge = document.createElement("span");
      themeBadge.className = "book-theme";
      themeBadge.textContent = book.theme;

      badgeRow.appendChild(themeBadge);

      if (Array.isArray(book.tags)) {
        book.tags.forEach((tag) => {
          const t = document.createElement("span");
          t.className = "book-tag";
          t.textContent = tag;
          badgeRow.appendChild(t);
        });
      }

      card.appendChild(title);
      card.appendChild(meta);
      card.appendChild(learning);
      card.appendChild(badgeRow);

      if (book.link) {
        const link = document.createElement("a");
        link.className = "book-link";
        link.href = book.link;
        link.target = "_blank";
        link.rel = "noopener noreferrer";
        link.textContent = "View book";
        card.appendChild(link);
      }

      booksGrid.appendChild(card);
    });
  }

  if (booksGrid) {
    renderBooks();

    if (bookSearch) {
      bookSearch.addEventListener("input", () => {
        renderBooks(bookSearch.value);
      });
    }
  }
});

